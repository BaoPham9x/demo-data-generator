module:
  identifier: "balances"
  schema: "steep_demo_fintech"
  table: "fact_balances"
  joinPaths:
    - from:
        column: "account_key"
      to:
        table: "dim_account"
        column: "account_key"
      type: "one-to-many"
    - from:
        column: "customer_key"
      to:
        table: "dim_customer"
        column: "customer_key"
      type: "one-to-many"
  dimensions:
    - column: "currency"
      type: "categorical"
      label: "Currency"
  metrics:
    - identifier: "avg_balance"
      name: "Average Balance"
      time: "fact_balances.balance_date"
      description: "Average account balance across all accounts."
      calculation: "custom-value"
      sql_expression: "AVG(fact_balances.balance_amount)"
      category: "Operations"
      dimensions:
        - "currency"
        - "dim_account.account_type"
        - "dim_account.account_status"
        - "dim_customer.customer_tier"
    - identifier: "total_balance"
      name: "Total Balance"
      time: "fact_balances.balance_date"
      description: "Sum of all account balances."
      calculation: "sum"
      value: "fact_balances.balance_amount"
      category: "Operations"
      dimensions:
        - "currency"
        - "dim_account.account_type"
    - identifier: "avg_balance_per_account"
      name: "Avg Balance per Account"
      time: "fact_balances.balance_date"
      description: "Average balance per account (sum of balances / distinct accounts)."
      calculation: "custom-ratio"
      numerator_sql: "SUM(fact_balances.balance_amount)"
      denominator_sql: "COUNT(DISTINCT fact_balances.account_key)"
      format: "number"
      category: "Operations"
      dimensions:
        - "currency"
        - "dim_account.account_type"
    - identifier: "balance_snapshots"
      name: "Balance Snapshots"
      time: "fact_balances.balance_date"
      description: "Number of balance snapshots recorded."
      calculation: "count"
      category: "Operations"
      dimensions:
        - "currency"
    - identifier: "unique_accounts_with_balance"
      name: "Accounts with Balance"
      time: "fact_balances.balance_date"
      description: "Number of unique accounts with balance snapshots."
      calculation: "count-distinct"
      distinct_on: "fact_balances.account_key"
      category: "Operations"
      dimensions:
        - "currency"
        - "dim_account.account_type"
    - identifier: "high_balance_accounts"
      name: "High Balance Accounts"
      time: "fact_balances.balance_date"
      description: "Number of accounts with balance > $10,000."
      calculation: "count-distinct"
      distinct_on: "fact_balances.account_key"
      filters:
        - column: "balance_amount"
          operator: "greater-than"
          expression: "10000"
      category: "Operations"
      dimensions:
        - "currency"
        - "dim_account.account_type"
