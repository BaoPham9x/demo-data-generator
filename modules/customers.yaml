module:
  identifier: "customers"
  schema: "demo_fintech"
  table: "dim_customer"
  dimensions:
    - column: "country"
      type: "country"
      label: "Country"
    - column: "city"
      type: "city"
      label: "City"
    - column: "region"
      type: "categorical"
      label: "Region"
    - column: "customer_tier"
      type: "categorical"
      label: "Customer Tier"
    - column: "registration_source"
      type: "categorical"
      label: "Registration Source"
    - column: "kyb_status"
      type: "categorical"
      label: "KYB Status"
    - column: "account_status"
      type: "categorical"
      label: "Account Status"
    - column: "email"
      type: "categorical"
      label: "Email"
  metrics:
    - identifier: "total_customers"
      name: "Customer Acquisition"
      time: "dim_customer.created_at"
      description: "Total number of new customers created in the system during a given period. This metric helps track growth and evaluate the effectiveness of acquisition strategies over time."
      calculation: "count"
      category: "Commercial"
      slices:
        - name: "Main Countries"
          filter:
            column: "country"
            operator: "in"
            expression: "US,GB,SE"
        - name: "Europe"
          filter:
            column: "region"
            operator: "equals"
            expression: "Europe"
      dimensions:
        - "country"
        - "city"
        - "region"
        - "customer_tier"
        - "registration_source"
        - "kyb_status"
    - identifier: "kyc_approved"
      name: "KYC Approved %"
      time: "dim_customer.created_at"
      description: "Percentage of users approved through KYC processes. KYC stands for 'Know Your Customer': used to verify a customer's identity and assess risk, helping prevent fraud and financial crimes."
      calculation: "custom-ratio"
      numerator_sql: "SUM(CASE WHEN dim_customer.kyb_status = 'approved' THEN 1 END)"
      denominator_sql: "COUNT(*)"
      format: "percentage"
      category: "Operations"
      dimensions:
        - "country"
        - "customer_tier"
        - "registration_source"
    - identifier: "activated_customers"
      name: "Activated Customers"
      time: "dim_customer.created_at"
      description: "Number of customers who have made at least one transaction."
      calculation: "count"
      filters:
        - column: "is_activated"
          operator: "equals"
          expression: "1"
      category: "Commercial"
      dimensions:
        - "country"
        - "customer_tier"
        - "registration_source"
    - identifier: "activation_rate"
      name: "Activation Rate"
      time: "dim_customer.created_at"
      description: "Percentage of customers who have activated (made at least one transaction)."
      calculation: "custom-ratio"
      numerator_sql: "SUM(CASE WHEN dim_customer.is_activated = 1 THEN 1 END)"
      denominator_sql: "COUNT(*)"
      format: "percentage"
      category: "Commercial"
      dimensions:
        - "country"
        - "customer_tier"
        - "registration_source"
    - identifier: "avg_time_to_activation"
      name: "Avg Time to Activation (Days)"
      time: "dim_customer.created_at"
      description: "Average number of days from customer creation to first transaction."
      calculation: "custom-value"
      sql_expression: "AVG(dim_customer.time_to_activation_days)"
      category: "Operations"
      dimensions:
        - "country"
        - "customer_tier"
    - identifier: "avg_kyb_completion_days"
      name: "Avg KYC Completion Days"
      time: "dim_customer.created_at"
      description: "Average number of days to complete KYC approval process."
      calculation: "custom-value"
      sql_expression: "AVG(dim_customer.kyb_completion_days)"
      category: "Operations"
      dimensions:
        - "country"
        - "customer_tier"
    - identifier: "registrations"
      name: "Registrations"
      time: "dim_customer.created_at"
      description: "Total number of user sign-ups."
      calculation: "count"
      category: "Marketing"
      dimensions:
        - "country"
        - "email"
  joinPaths:
    - from:
        column: "customer_key"
      to:
        table: "fact_transactions"
        column: "customer_key"
      type: "one-to-many"
    - from:
        column: "customer_key"
      to:
        table: "fact_subscriptions"
        column: "customer_key"
      type: "one-to-many"
    - from:
        column: "customer_key"
      to:
        table: "fact_customer_features"
        column: "customer_key"
      type: "one-to-many"