module:
  identifier: "subscriptions"
  schema: "demo_fintech"
  table: "fact_subscriptions"
  dimensions:
    - column: "plan_name"
      type: "categorical"
      label: "Plan Name"
    - column: "status"
      type: "categorical"
      label: "Status"
    - column: "billing_cycle"
      type: "categorical"
      label: "Billing Cycle"
    - column: "currency"
      type: "categorical"
      label: "Currency"
  metrics:
    - identifier: "mrr"
      name: "Monthly Recurring Revenue"
      time: "fact_subscriptions.started_at"
      description: "Total Monthly Recurring Revenue from active subscriptions."
      calculation: "sum"
      value: "fact_subscriptions.mrr"
      filters:
        - column: "status"
          operator: "equals"
          expression: "active"
      category: "Commercial"
      slices:
        - name: "Enterprise"
          filter:
            column: "plan_name"
            operator: "equals"
            expression: "enterprise"
        - name: "Premium"
          filter:
            column: "plan_name"
            operator: "equals"
            expression: "premium"
      dimensions:
        - "plan_name"
        - "billing_cycle"
        - "currency"
        - "dim_customer.customer_tier"
        - "dim_customer.country"
    - identifier: "arr"
      name: "Annual Recurring Revenue"
      time: "fact_subscriptions.started_at"
      description: "Total Annual Recurring Revenue from active subscriptions."
      calculation: "sum"
      value: "fact_subscriptions.arr"
      filters:
        - column: "status"
          operator: "equals"
          expression: "active"
      category: "Commercial"
      dimensions:
        - "plan_name"
        - "currency"
        - "dim_customer.customer_tier"
    - identifier: "churned_mrr"
      name: "Churned MRR"
      time: "fact_subscriptions.ended_at"
      description: "Monthly Recurring Revenue lost from cancelled subscriptions."
      calculation: "sum"
      value: "fact_subscriptions.mrr"
      filters:
        - column: "status"
          operator: "equals"
          expression: "cancelled"
      category: "Commercial"
      dimensions:
        - "plan_name"
        - "dim_customer.customer_tier"
    - identifier: "new_mrr"
      name: "New MRR"
      time: "fact_subscriptions.started_at"
      description: "Monthly Recurring Revenue from new subscriptions started in the period."
      calculation: "sum"
      value: "fact_subscriptions.mrr"
      filters:
        - column: "status"
          operator: "equals"
          expression: "active"
      category: "Commercial"
      dimensions:
        - "plan_name"
        - "dim_customer.customer_tier"
    - identifier: "active_subscriptions"
      name: "Active Subscriptions"
      time: "fact_subscriptions.started_at"
      description: "Number of active subscriptions."
      calculation: "count"
      filters:
        - column: "status"
          operator: "equals"
          expression: "active"
      category: "Commercial"
      dimensions:
        - "plan_name"
        - "billing_cycle"
        - "dim_customer.customer_tier"
    - identifier: "churn_rate"
      name: "Subscription Churn Rate"
      time: "fact_subscriptions.ended_at"
      description: "Percentage of subscriptions that were cancelled."
      calculation: "custom-ratio"
      numerator_sql: "SUM(CASE WHEN fact_subscriptions.status = 'cancelled' THEN 1 END)"
      denominator_sql: "COUNT(*)"
      format: "percentage"
      category: "Commercial"
      dimensions:
        - "plan_name"
        - "dim_customer.customer_tier"
    - identifier: "avg_monthly_price"
      name: "Avg Monthly Price"
      time: "fact_subscriptions.started_at"
      description: "Average monthly subscription price."
      calculation: "custom-value"
      sql_expression: "AVG(fact_subscriptions.monthly_price)"
      filters:
        - column: "status"
          operator: "equals"
          expression: "active"
      category: "Commercial"
      dimensions:
        - "plan_name"
        - "billing_cycle"
  joinPaths:
    - from:
        column: "customer_key"
      to:
        table: "dim_customer"
        column: "customer_key"
      type: "one-to-many"
