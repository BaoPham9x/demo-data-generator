module:
  identifier: "risk_events"
  schema: "demo_fintech"
  table: "fact_risk_events"
  joinPaths:
    - from:
        column: "customer_key"
      to:
        table: "dim_customer"
        column: "customer_key"
      type: "one-to-many"
    - from:
        column: "transaction_id"
      to:
        table: "fact_transactions"
        column: "transaction_id"
      type: "one-to-many"
  dimensions:
    - column: "event_type"
      type: "categorical"
      label: "Event Type"
    - column: "severity"
      type: "categorical"
      label: "Severity"
    - column: "status"
      type: "categorical"
      label: "Status"
  metrics:
    - identifier: "total_risk_events"
      name: "Total Risk Events"
      time: "fact_risk_events.created_at"
      description: "Total number of risk events created."
      calculation: "count"
      category: "Operations"
      dimensions:
        - "event_type"
        - "severity"
        - "status"
        - "dim_customer.customer_tier"
    - identifier: "open_risk_events"
      name: "Open Risk Events"
      time: "fact_risk_events.created_at"
      description: "Number of risk events currently open or under investigation."
      calculation: "count"
      filters:
        - column: "status"
          operator: "in"
          expression: "open,investigating"
      category: "Operations"
      dimensions:
        - "event_type"
        - "severity"
    - identifier: "fraud_alerts"
      name: "Fraud Alerts"
      time: "fact_risk_events.created_at"
      description: "Number of fraud alerts detected."
      calculation: "count"
      filters:
        - column: "event_type"
          operator: "equals"
          expression: "fraud_alert"
      category: "Operations"
      dimensions:
        - "severity"
        - "status"
        - "dim_customer.customer_tier"
    - identifier: "false_positive_rate"
      name: "False Positive Rate"
      time: "fact_risk_events.created_at"
      description: "Percentage of risk events that were false positives."
      calculation: "custom-ratio"
      numerator_sql: "SUM(CASE WHEN fact_risk_events.status = 'false_positive' THEN 1 END)"
      denominator_sql: "COUNT(*)"
      format: "percentage"
      category: "Operations"
      dimensions:
        - "event_type"
        - "severity"
    - identifier: "avg_resolution_time"
      name: "Avg Resolution Time (Hours)"
      time: "fact_risk_events.created_at"
      description: "Average time to resolve risk events in hours."
      calculation: "custom-value"
      sql_expression: "AVG(fact_risk_events.resolution_time_hours)"
      category: "Operations"
      dimensions:
        - "event_type"
        - "severity"
    - identifier: "critical_events"
      name: "Critical Risk Events"
      time: "fact_risk_events.created_at"
      description: "Number of critical severity risk events."
      calculation: "count"
      filters:
        - column: "severity"
          operator: "equals"
          expression: "critical"
      category: "Operations"
      dimensions:
        - "event_type"
        - "status"
    - identifier: "aml_flags"
      name: "AML Flags"
      time: "fact_risk_events.created_at"
      description: "Number of Anti-Money Laundering flags."
      calculation: "count"
      filters:
        - column: "event_type"
          operator: "equals"
          expression: "aml_flag"
      category: "Compliance"
      dimensions:
        - "severity"
        - "status"
        - "dim_customer.customer_tier"
    - identifier: "resolved_events"
      name: "Resolved Events"
      time: "fact_risk_events.resolved_at"
      description: "Number of risk events that were resolved."
      calculation: "count"
      filters:
        - column: "status"
          operator: "in"
          expression: "resolved,false_positive"
      category: "Operations"
      dimensions:
        - "event_type"
        - "severity"
