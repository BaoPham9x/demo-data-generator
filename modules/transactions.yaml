module:
  identifier: "transactions"
  schema: "demo_fintech"
  table: "fact_transactions"
  joinPaths:
    - from:
        column: "customer_key"
      to:
        table: "dim_customer"
        column: "customer_key"
      type: "one-to-many"
  dimensions:
    - column: "currency"
      type: "categorical"
      label: "Currency"
    - column: "country"
      type: "country"
      label: "Country"
    - column: "transaction_type"
      type: "categorical"
      label: "Transaction Type"
    - column: "status"
      type: "categorical"
      label: "Status"
    - column: "merchant_category"
      type: "categorical"
      label: "Merchant Category"
    - column: "payment_method"
      type: "categorical"
      label: "Payment Method"
    - column: "risk_flag"
      type: "categorical"
      label: "Risk Flag"
    - column: "customer_id"
      type: "categorical"
      label: "Customer id"
  metrics:
    - identifier: "transaction_volume"
      name: "Transaction Volume (TPV)"
      time: "fact_transactions.created_at"
      description: "Total volume of completed transactions. Includes card payments, transfers, deposits, and withdrawals."
      calculation: "sum"
      value: "fact_transactions.amount"
      filters:
        - column: "status"
          operator: "equals"
          expression: "completed"
      category: "Commercial"
      slices:
        - name: "US"
          filter:
            column: "country"
            operator: "equals"
            expression: "US"
        - name: "Card Spend Only"
          filter:
            column: "transaction_type"
            operator: "equals"
            expression: "card_spend"
      dimensions:
        - "country"
        - "currency"
        - "transaction_type"
        - "merchant_category"
        - "payment_method"
        - "dim_customer.customer_tier"
        - "dim_customer.email"
    - identifier: "revenue"
      name: "Revenue"
      time: "fact_transactions.created_at"
      description: "Includes all card payment fees."
      calculation: "sum"
      value: "fact_transactions.amount"
      filters:
        - column: "status"
          operator: "equals"
          expression: "completed"
      category: "Commercial"
      slices:
        - name: "3.SE"
          filter:
            column: "country"
            operator: "equals"
            expression: "SE"
        - name: "2.CA"
          filter:
            column: "country"
            operator: "equals"
            expression: "CA"
      dimensions:
        - "customer_id"
        - "country"
        - "currency"
    - identifier: "avg_transaction_amount"
      name: "Avg Transaction Amount"
      time: "fact_transactions.created_at"
      description: "The average value of each completed transaction."
      calculation: "custom-ratio"
      numerator_sql: "SUM(fact_transactions.amount)"
      denominator_sql: "COUNT(*)"
      format: "number"
      filters:
        - column: "status"
          operator: "equals"
          expression: "completed"
      category: "Operations"
      dimensions:
        - "country"
        - "currency"
        - "transaction_type"
        - "merchant_category"
        - "dim_customer.customer_tier"
        - "dim_customer.email"
    - identifier: "transaction_count"
      name: "Transaction Count"
      time: "fact_transactions.created_at"
      description: "Total number of transactions."
      calculation: "count"
      category: "Operations"
      dimensions:
        - "country"
        - "currency"
        - "status"
        - "transaction_type"
        - "merchant_category"
        - "payment_method"
        - "dim_customer.customer_tier"
    - identifier: "completed_transactions"
      name: "Completed Transactions"
      time: "fact_transactions.created_at"
      description: "Number of successfully completed transactions."
      calculation: "count"
      filters:
        - column: "status"
          operator: "equals"
          expression: "completed"
      category: "Operations"
      dimensions:
        - "country"
        - "transaction_type"
        - "dim_customer.customer_tier"
    - identifier: "failed_transactions"
      name: "Failed Transactions"
      time: "fact_transactions.created_at"
      description: "Number of failed transactions."
      calculation: "count"
      filters:
        - column: "status"
          operator: "equals"
          expression: "failed"
      category: "Operations"
      dimensions:
        - "country"
        - "transaction_type"
    - identifier: "success_rate"
      name: "Transaction Success Rate"
      time: "fact_transactions.created_at"
      description: "Percentage of transactions that completed successfully."
      calculation: "custom-ratio"
      numerator_sql: "SUM(CASE WHEN fact_transactions.status = 'completed' THEN 1 END)"
      denominator_sql: "COUNT(*)"
      format: "percentage"
      category: "Operations"
      dimensions:
        - "country"
        - "transaction_type"
        - "payment_method"
    - identifier: "active_customers"
      name: "Active Customers"
      time: "fact_transactions.created_at"
      description: "Number of unique customers who made transactions during the period."
      calculation: "count-distinct"
      distinct_on: "fact_transactions.customer_key"
      filters:
        - column: "status"
          operator: "equals"
          expression: "completed"
      category: "Commercial"
      dimensions:
        - "country"
        - "dim_customer.customer_tier"
    - identifier: "high_risk_transactions"
      name: "High Risk Transactions"
      time: "fact_transactions.created_at"
      description: "Number of transactions flagged as high risk or suspicious."
      calculation: "count"
      filters:
        - column: "risk_flag"
          operator: "in"
          expression: "high_risk,suspicious,aml_review"
      category: "Operations"
      dimensions:
        - "country"
        - "transaction_type"
        - "dim_customer.customer_tier"